@model BilheticaAeronauticaWeb.Models.ShoppingBasketWithUserViewModel

@{
    ViewData["Title"] = "Purchase";
}

<h1>Your Final Order</h1>
<form asp-controller="Orders" asp-action="Purchase" method="post">
    <div asp-validation-summary="ModelOnly"></div>

    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Surname</th>
                <th>Class</th>
                <th>Flight</th>
                <th>Price</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.ShoppingBasketTickets.Count; i++)
            {
                var item = Model.ShoppingBasketTickets[i];
                <tr>
                    <td>
                        <input type="hidden" asp-for="ShoppingBasketTickets[@i].Name" />
                        @item.Name
                    </td>
                    <td>
                        <input type="hidden" asp-for="ShoppingBasketTickets[@i].Surname" />
                        @item.Surname
                    </td>
                    <td>
                        <input type="hidden" asp-for="ShoppingBasketTickets[@i].Class" />
                        @item.Class
                    </td>
                    <td>
                        <input type="hidden" asp-for="ShoppingBasketTickets[@i].PassengerType" />
                        @item.PassengerType
                    </td>
                    <td>
                        <input type="hidden" asp-for="ShoppingBasketTickets[@i].FlightId" />
                        @item.FlightId
                    </td>
                    <td>
                        <input type="hidden" asp-for="ShoppingBasketTickets[@i].Price" />
                        @item.Price.ToString("C")
                    </td>
                    <td>
                        @if (item.SeatId == null || item.SeatId == 0)
                        {
                            <span class="text-danger">Please choose a seat</span>
                            <select asp-for="ShoppingBasketTickets[@i].SeatId" class="form-control">
                                <option value="">Select a seat</option>
                                @{
                                    var seatsList = ViewBag.Seats as IEnumerable<SelectListItem>;
                                }
                                @foreach (var seat in seatsList)
                                {
                                    <option value="@seat.Value">@seat.Text</option>
                                }
                            </select>
                        }
                        else
                        {
                            @item.SeatId
                            <input type="hidden" asp-for="ShoppingBasketTickets[@i].SeatId" />
                        }
                    </td>
                </tr>
            }

        </tbody>
    </table>

    @if (!User.Identity.IsAuthenticated)
    {
        <div class="form-group">
            <label asp-for="NewUser.FirstName">First Name</label>
            <input asp-for="NewUser.FirstName" class="form-control" />
            <span asp-validation-for="NewUser.FirstName" class="text-warning"></span>
        </div>

        <div class="form-group">
            <label asp-for="NewUser.LastName">Last Name</label>
            <input asp-for="NewUser.LastName" class="form-control" />
            <span asp-validation-for="NewUser.LastName" class="text-warning"></span>
        </div>

        <div class="form-group">
            <label asp-for="NewUser.Username">Username</label>
            <input asp-for="NewUser.Username" class="form-control" />
            <span asp-validation-for="NewUser.Username" class="text-warning"></span>
        </div>

        <div class="form-group">
            <label asp-for="NewUser.Password">Password</label>
            <input asp-for="NewUser.Password" type="password" class="form-control" />
            <span asp-validation-for="NewUser.Password" class="text-warning"></span>
        </div>

        <div class="form-group">
            <label asp-for="NewUser.Confirm">Confirm</label>
            <input asp-for="NewUser.Confirm" type="password" class="form-control" />
            <span asp-validation-for="NewUser.Confirm" class="text-warning"></span>
        </div>
    }

    <button type="submit" class="btn btn-success">Confirm</button>
</form>
